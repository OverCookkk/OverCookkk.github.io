---
title: Elasticsearch
#tags: []      #添加的标签
categories: 
  - 中间件
  - elasticsearch
description: 全文搜索引擎是目前广泛应用的主流搜索引擎
cover: https://raw.githubusercontent.com/OverCookkk/PicBed/master/blog_cover_images/00706-1772420198.png
---



什么是全文搜索引擎？

> **百度百科中的定义**： 全文搜索引擎是目前广泛应用的主流搜索引擎。它的工作原理是计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。



## 数据类型

从定义中我们已经可以大致了解全文检索的思路了，为了更详细的说明，我们先从生活中的数据说起。

我们生活中的数据总体分为两种：**结构化数据** 和 **非结构化数据**。

- **结构化数据**： 指具有固定格式或有限长度的数据，如数据库，元数据等。
- **非结构化数据**： 非结构化数据又可称为全文数据，指不定长或无固定格式的数据，如邮件，word文档等。





## 使用ES而不是数据库的原因

1. 数据模型：数据库通常采用**结构化数据模型**，使用表格和列来组织和存储数据。ES则采用**面向文档的数据模型**，将数据存储为自包含的JSON文档。这使得ES更适合存储和搜索非结构化或半结构化的数据，如日志、文本文档、地理位置数据等。
2. 搜索和分析能力：ES专注于全文搜索和实时分析，提供强大的搜索、聚合和分析功能。它使用**倒排索引**和**分布式架构**来支持高性能的搜索和复杂的查询操作。相比之下，传统数据库的搜索功能较为有限，对于大规模文本搜索和复杂的聚合查询可能效率较低。
3. 弹性和扩展性：ES具有良好的水平扩展能力，可以轻松地通过添加节点来增加容量和吞吐量。它的分布式架构和自动分片机制使得数据可以并行处理和存储在多个节点上，从而实现高可用性和容错性。传统数据库在处理大规模数据和高并发负载时可能面临性能瓶颈和扩展困难。
4. 实时性：ES提供近实时搜索能力，即文档索引后几乎立即可进行搜索。这使得ES适用于需要快速响应和实时更新的应用场景，如实时日志分析、监控和仪表盘。传统数据库通常具有更高的一致性和事务支持，但在实时性方面可能不如ES。
5. 多种用例支持：ES广泛应用于全文搜索、日志分析、电子商务搜索、内容推荐、地理空间分析等多个领域。它提供了丰富的搜索、聚合和分析功能，以及与Kibana等工具的集成，使得数据探索和可视化更加便捷。传统数据库则更适用于事务处理、关系型数据管理和复杂的数据操作。

综上所述，选择使用ES而不是传统数据库的原因在于其强大的搜索和分析能力、良好的扩展性和实时性，以及适用于非结构化或半结构化数据的存储和检索需求。然而，具体选择何种技术取决于应用的特定需求和数据模型。在某些情况下，数据库和ES可以结合使用，以满足不同层次的数据管理和查询需求。



## 倒排索引

生成的倒排索引中，词条会排序，形成一颗树形结构，提升词条的查询速度。

如下图所示，查询"华为"会得到对应的value=1和3，再通过1和3找到id=1和3的文档。

![ElasticSearch数据的存储和搜索原理](https://raw.githubusercontent.com/OverCookkk/PicBed/master/blogImg/ElasticSearch%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AD%98%E5%82%A8%E5%92%8C%E6%90%9C%E7%B4%A2%E5%8E%9F%E7%90%86.png)



## ES基本概念与关系型数据库的比较

| ES概念                                         | 关系型数据库       |
| :--------------------------------------------- | :----------------- |
| Index（索引）支持全文检索                      | Database（数据库） |
| Type（类型）                                   | Table（表）        |
| Document（文档），不同文档可以有不同的字段集合 | Row（数据行）      |
| Field（字段）                                  | Column（数据列）   |
| Mapping（映射）                                | Schema（模式）     |





## Elasticsearch vs Solr的选择

由于Lucene的复杂性，一般很少会考虑它作为搜索的第一选择，排除一些公司需要自研搜索框架，底层需要依赖Lucene。所以这里我们重点分析 Elasticsearch 和 Solr。

这两个搜索引擎都是流行的，先进的的开源搜索引擎。它们都是围绕核心底层搜索库 - Lucene构建的 - 但它们又是不同的。像所有东西一样，每个都有其优点和缺点，根据您的需求和期望，每个都可能更好或更差。Solr和Elasticsearch都在快速发展，所以，话不多说，先来看下它们的差异清单：

|       特征        |                        Solr/SolrCloud                        |                        Elasticsearch                         |
| :---------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|   社区和开发者    |                  Apache 软件基金和社区支持                   |                     单一商业实体及其员工                     |
|     节点发现      |       Apache Zookeeper，在大量项目中成熟且经过实战测试       | Zen内置于Elasticsearch本身，需要专用的主节点才能进行分裂脑保护 |
|     碎片放置      | 本质上是静态，需要手动工作来迁移分片，从Solr 7开始 - Autoscaling API允许一些动态操作 |              动态，可以根据群集状态按需移动分片              |
|     高速缓存      |                     全局，每个段更改无效                     |                   每段，更适合动态更改数据                   |
|   分析引擎性能    |                  非常适合精确计算的静态数据                  |                  结果的准确性取决于数据放置                  |
|   全文搜索功能    |  基于Lucene的语言分析，多建议，拼写检查，丰富的高亮显示支持  |   基于Lucene的语言分析，单一建议API实现，高亮显示重新计算    |
|    DevOps支持     |                     尚未完全，但即将到来                     |                         非常好的API                          |
|  非平面数据处理   |                     嵌套文档和父-子支持                      |    嵌套和对象类型的自然支持允许几乎无限的嵌套和父-子支持     |
|      查询DSL      |              JSON（有限），XML（有限）或URL参数              |                             JSON                             |
| 索引/收集领导控制 |      领导者安置控制和领导者重新平衡甚至可以节点上的负载      |                            不可能                            |
|     机器学习      |    内置 - 在流聚合之上，专注于逻辑回归和学习排名贡献模块     |         商业功能，专注于异常和异常值以及时间序列数据         |